# å‡ç´šç³»çµ±æ¶æ§‹è®Šæ›´è¨˜éŒ„

## ğŸ“‹ è®Šæ›´æ—¥æœŸ
2026-01-19

## ğŸ¯ æ ¸å¿ƒæ”¹å‹•

### ä¹‹å‰çš„æ¶æ§‹ï¼ˆå·²ç§»é™¤ï¼‰
```
database/
â””â”€â”€ level_system.py
    â”œâ”€â”€ Level æ¨¡å‹ï¼ˆé€šç”¨è¡¨ï¼‰
    â”‚   â”œâ”€â”€ player_id
    â”‚   â”œâ”€â”€ system_type ï¼ˆ"character", "fishing", "mining"ï¼‰
    â”‚   â”œâ”€â”€ level
    â”‚   â””â”€â”€ experience
```

**å•é¡Œï¼š**
- èªç¾©ä¸æ¸…ï¼šcharacter å’Œ skill æ··åœ¨åŒä¸€å¼µè¡¨
- é›£ä»¥æ“´å±•ï¼šç„¡æ³•ç‚ºä¸åŒç³»çµ±æ·»åŠ å°ˆå±¬å±¬æ€§
- åˆªé™¤ç³»çµ±å›°é›£ï¼šå½±éŸ¿æ•´å€‹ Level è¡¨

---

### æ–°æ¶æ§‹ï¼ˆç¾å·²å¯¦æ–½ï¼‰
```
database/
â”œâ”€â”€ character.py
â”‚   â””â”€â”€ Character æ¨¡å‹
â”‚       â”œâ”€â”€ player_id (ForeignKey)
â”‚       â”œâ”€â”€ level
â”‚       â”œâ”€â”€ experience
â”‚       â””â”€â”€ æ–¹æ³•ï¼šadd_experience(), get_progress()
â”‚
â””â”€â”€ skill.py
    â””â”€â”€ Skill æ¨¡å‹
        â”œâ”€â”€ player_id (ForeignKey)
        â”œâ”€â”€ skill_type ("fishing", "mining", "cooking" ç­‰)
        â”œâ”€â”€ level
        â”œâ”€â”€ experience
        â””â”€â”€ æ–¹æ³•ï¼šadd_experience(), get_progress(), get_all_skills()
```

**å„ªå‹¢ï¼š**
- âœ… èªç¾©æ¸…æ™°ï¼šCharacter å°ˆé–€ç”¨æ–¼è§’è‰²ç­‰ç´šï¼ŒSkill ç”¨æ–¼æŠ€èƒ½
- âœ… æ˜“æ–¼æ“´å±•ï¼šæœªä¾†å¯ç‚º Skill æ·»åŠ  `cooldown`ã€`success_rate` ç­‰å±¬æ€§
- âœ… æ˜“æ–¼åˆªé™¤ï¼šæƒ³åˆªé™¤æŸå€‹æŠ€èƒ½ç³»çµ±æ™‚ï¼Œåªéœ€åˆªé™¤å°æ‡‰ skill_type çš„è¨˜éŒ„
- âœ… éˆæ´»æ€§é«˜ï¼šä¸åŒç³»çµ±å¯æœ‰å®Œå…¨ä¸åŒçš„å‡ç´šé‚è¼¯

---

## ğŸ”„ é·ç§»è©³æƒ…

### æ–‡ä»¶è®Šæ›´
1. **æ–°å¢ï¼š** `database/character.py` - è§’è‰²ç­‰ç´šç³»çµ±
2. **æ–°å¢ï¼š** `database/skill.py` - æŠ€èƒ½ç³»çµ±åŸºç¤ï¼ˆé‡£é­šã€æŒ–ç¤¦ï¼‰
3. **ä¿®æ”¹ï¼š** `database/__init__.py` - æ›´æ–°åˆå§‹åŒ–é †åº
4. **ä¿®æ”¹ï¼š** `cogs/leveling.py` - å°å…¥å’Œæ–¹æ³•èª¿ç”¨æ›´æ–°
5. **ä¿®æ”¹ï¼š** `test_level_system.py` - æ¸¬è©¦æ›´æ–°
6. **ä¿®æ”¹ï¼š** `test_leveling.py` - æ¸¬è©¦æ›´æ–°
7. **åˆªé™¤ï¼š** `database/level_system.py` - å·²è¢« character.py å’Œ skill.py æ›¿ä»£

### åˆå§‹åŒ–é †åº
```python
init_all_databases()
  â”œâ”€â”€ 1ï¸âƒ£ Player è¡¨ï¼ˆæ ¸å¿ƒï¼‰
  â”œâ”€â”€ 2ï¸âƒ£ Dummy è¡¨ï¼ˆç¨ç«‹ï¼‰
  â”œâ”€â”€ 3ï¸âƒ£ Affection è¡¨ï¼ˆä¾è³´ Player + Dummyï¼‰
  â”œâ”€â”€ 4ï¸âƒ£ Character è¡¨ï¼ˆä¾è³´ Player - è§’è‰²ç­‰ç´šï¼‰
  â””â”€â”€ 5ï¸âƒ£ Skill è¡¨ï¼ˆä¾è³´ Player - æŠ€èƒ½ç­‰ç´šï¼‰
```

---

## ğŸ“Š æ•¸æ“šåº«æ¶æ§‹

### Character è¡¨
```sql
CREATE TABLE character (
  id INTEGER PRIMARY KEY,
  player_id INTEGER UNIQUE NOT NULL,
  level INTEGER DEFAULT 1,
  experience INTEGER DEFAULT 0,
  FOREIGN KEY (player_id) REFERENCES player(id) ON DELETE CASCADE
)
```

### Skill è¡¨
```sql
CREATE TABLE skill (
  id INTEGER PRIMARY KEY,
  player_id INTEGER NOT NULL,
  skill_type TEXT NOT NULL,
  level INTEGER DEFAULT 1,
  experience INTEGER DEFAULT 0,
  UNIQUE (player_id, skill_type),
  FOREIGN KEY (player_id) REFERENCES player(id) ON DELETE CASCADE
)
```

---

## ğŸ® ç©å®¶äº’å‹•æµç¨‹

### è¨Šæ¯ç¶“é©—ï¼ˆç¾æœ‰ï¼‰
```
ç©å®¶ç™¼é€è¨Šæ¯
  â†“
@on_message ç›£è½
  â†“
æª¢æŸ¥å†·å»æ™‚é–“ï¼ˆ30ç§’ï¼‰
  â†“
Character.add_experience(user_id, 5)
  â†“
æª¢æŸ¥å‡ç´š â†’ å»£æ’­é€šçŸ¥
```

### èªéŸ³ç¶“é©—ï¼ˆç¾æœ‰ï¼‰
```
ç©å®¶åŠ å…¥èªéŸ³
  â†“ ï¼ˆè¨˜éŒ„æ™‚é–“æˆ³ï¼‰
ç©å®¶é›¢é–‹èªéŸ³
  â†“ ï¼ˆè¨ˆç®—åœç•™æ™‚é–“ï¼‰
Character.add_experience(user_id, exp)
  â†“
æª¢æŸ¥å‡ç´š â†’ å»£æ’­é€šçŸ¥
```

### æŠ€èƒ½ç¶“é©—ï¼ˆç‚ºæœªä¾†æº–å‚™ï¼‰
```
ç©å®¶é€²è¡ŒæŠ€èƒ½è¡Œç‚ºï¼ˆé‡£é­šã€æŒ–ç¤¦ï¼‰
  â†“
Skill.add_experience(user_id, exp, skill_type)
  â†“
æª¢æŸ¥å‡ç´š â†’ å»£æ’­é€šçŸ¥
```

---

## âœ… æ¸¬è©¦é©—è­‰

### æ¸¬è©¦çµæœ
```
âœ… test_level_system.py - 7 å€‹æ¸¬è©¦å…¨éƒ¨é€šé
âœ… test_leveling.py - 7 å€‹æ¸¬è©¦å…¨éƒ¨é€šé
âœ… æ©Ÿå™¨äººå•Ÿå‹•æ¸¬è©¦ - æˆåŠŸç™»å…¥å’ŒåŒæ­¥æŒ‡ä»¤
```

### é©—è­‰é …ç›®
- âœ… Character ç³»çµ±åˆå§‹åŒ–
- âœ… Skill ç³»çµ±åˆå§‹åŒ–
- âœ… è¨Šæ¯ç¶“é©—å¢åŠ é‚è¼¯
- âœ… å‡ç´šæª¢æ¸¬å’Œé€šçŸ¥
- âœ… é€²åº¦æŸ¥è©¢åŠŸèƒ½
- âœ… èªéŸ³æ™‚é–“è¨ˆç®—
- âœ… å†·å»æ™‚é–“æª¢æŸ¥
- âœ… å¤šæŠ€èƒ½æ”¯æŒ

---

## ğŸš€ æœªä¾†æ“´å±•ä¾‹å­

### æ·»åŠ é‡£é­šç³»çµ±
```python
# ç°¡å–®ï¼åªéœ€åœ¨éœ€è¦çš„åœ°æ–¹èª¿ç”¨ï¼š
result = Skill.add_experience(user_id, exp, "fishing")

# æœªä¾†å¯æ·»åŠ æŠ€èƒ½å°ˆå±¬å±¬æ€§ï¼š
class Skill(Model):
    skill_type = TextField()
    cooldown = IntegerField(default=0)  # æŠ€èƒ½å†·å»æ™‚é–“
    success_rate = FloatField(default=100)  # æˆåŠŸç‡
```

### æ·»åŠ çƒ¹é£ªç³»çµ±
```python
# åŒæ¨£çš„æ–¹å¼ï¼š
Skill.add_experience(user_id, exp, "cooking")
```

### æ·»åŠ è§’è‰²å±¬æ€§
```python
# Character å¯æ·»åŠ è§’è‰²å°ˆå±¬å±¬æ€§ï¼š
class Character(Model):
    class_type = TextField()  # "warrior", "mage" ç­‰
    health = IntegerField()
    mana = IntegerField()
    # ç­‰ç­‰...
```

---

## ğŸ“ æŸ¥è©¢æŒ‡ä»¤

### ç•¶å‰æ”¯æŒçš„æŒ‡ä»¤
```
!ç­‰ç´š                  - æŸ¥çœ‹è‡ªå·±çš„è§’è‰²ç­‰ç´š
!ç­‰ç´š @ç©å®¶            - æŸ¥çœ‹æŒ‡å®šç©å®¶çš„è§’è‰²ç­‰ç´š
!æ’è¡Œæ¦œ                - æŸ¥çœ‹è§’è‰²ç­‰ç´šæ’è¡Œæ¦œ
```

### æœªä¾†æŠ€èƒ½æŸ¥è©¢æŒ‡ä»¤ï¼ˆå¾…å¯¦ç¾ï¼‰
```
!é‡£é­šç­‰ç´š              - æŸ¥çœ‹é‡£é­šæŠ€èƒ½ç­‰ç´š
!æŒ–ç¤¦ç­‰ç´š              - æŸ¥çœ‹æŒ–ç¤¦æŠ€èƒ½ç­‰ç´š
!æŠ€èƒ½æ’è¡Œæ¦œ é‡£é­š       - æŸ¥çœ‹é‡£é­šç­‰ç´šæ’è¡Œæ¦œ
```

---

## ğŸ’¡ è¨­è¨ˆå„ªå‹¢ç¸½çµ

| æ–¹é¢ | èˆŠæ¶æ§‹ï¼ˆé€šç”¨è¡¨ï¼‰ | æ–°æ¶æ§‹ï¼ˆåˆ†é›¢è¡¨ï¼‰ |
|------|-----------------|-----------------|
| èªç¾©æ¸…æ™°åº¦ | âŒ æ¨¡ç³Š | âœ… æ¸…æ™° |
| æ“´å±•æ€§ | âŒ å›°é›£ | âœ… ç°¡å–® |
| ç³»çµ±åˆªé™¤ | âŒ è¤‡é›œ | âœ… ç°¡å–® |
| å±¬æ€§éˆæ´»æ€§ | âŒ å—é™ | âœ… é«˜ |
| ä»£ç¢¼å¯è®€æ€§ | âŒ ä½ | âœ… é«˜ |
| æŸ¥è©¢æ•ˆç‡ | âœ… ç›¸åŒ | âœ… ç›¸åŒ |

---

## ğŸ“ å­¸ç¿’é‡é»

æœ¬æ¬¡æ¶æ§‹å„ªåŒ–å±•ç¤ºäº†ä»¥ä¸‹è¨­è¨ˆåŸå‰‡ï¼š

1. **å–®ä¸€è²¬ä»»åŸå‰‡**ï¼šæ¯å€‹æ¨¡å‹åªè² è²¬ä¸€å€‹è²¬ä»»
2. **é–‹é–‰åŸå‰‡**ï¼šå°æ“´å±•é–‹æ”¾ï¼Œå°ä¿®æ”¹é—œé–‰
3. **èªç¾©æ¸…æ™°**ï¼šä»£ç¢¼è‡ªè¨»é‡‹ï¼Œæ˜“æ–¼ç†è§£
4. **æœªä¾†è€ƒé‡**ï¼šè¨­è¨ˆæ™‚è€ƒæ…®å¯èƒ½çš„æ“´å±•æ–¹å‘

